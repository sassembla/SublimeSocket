<!DOCTYPE html>
<html lang="fr" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>SublimeSocket Preferences</title>
    <meta charset="UTF-8" />
    <link href="../resource/css/bootstrap.min.css" rel="stylesheet">

    <script type="text/javascript">
      

      //generage uuid for SublimeSocket api
      var uuid = (function(){
          var S4 = function() {
              return (((1+Math.random())*0x10000)|0).toString(16).substring(1);
          }   
          return (S4()+S4()+"-"+S4()+"-"+S4()+"-"+S4()+"-"+S4()+S4() +S4());
      })();

      var setter = {
        set : function (input) {
          //set params
          document.getElementById('send').value = input;
        }
        
      }
      
      var _WS = {

        //websoket port (will be replaced by SublimeSocket plugin)
        uri: 'ws://SUBLIMESOCKET_HOST:SUBLIMESOCKET_PORT/',
        
        ws: null,

        init : function (e) {
          _WS.s = new WebSocket(_WS.uri);
          _WS.s.onopen = function (e) { _WS.onOpen(e); };
          _WS.s.onclose = function (e) { _WS.onClose(e); };
          _WS.s.onmessage = function (e) { _WS.onMessage(e); };
          _WS.s.onerror = function (e) { _WS.onError(e); };
        },

        onOpen: function () {
          _WS.writeLog('<span class="label label-success">RESPONSE:CONNECTED</span>');

          //call api then get callback
          _WS.s.send('sublimesocket@inputIdentity:{\"id\":\"'+uuid+'\"}');
        },

        onClose: function () {
          _WS.writeLog('<span class="label label-important">RESPONSE:DISCONNECTED</span>');
        },

        onMessage: function (e) {
          _WS.writeLog('<span class="label label-success">RESPONSE: ' + e.data + '</span>');
        },

        onError: function (e) {
          _WS.writeLog('<span style="color: red;">ERROR:</span> ' + e.data);
        },


        //Methods
        /*
        write textlist
        */
        writeLog: function (message) {
            var childNodes = document.getElementById('output').childNodes;
            var p = document.createElement('p');
            p.style.wordWrap = 'break-word';
            p.innerHTML = message.toString();
            document.getElementById('output').insertBefore(p, childNodes[0]);
        },
        send: function (message) {
          if (!message.length) {
            alert('Empty message not allowed !');
          } else {
            _WS.writeLog('<span class="label label-info">SEND: ' + message + '</span>');
            _WS.s.send(message);
          }
        },
        close: function () {//no one call
          _WS.writeLog('<span class="label">CLOSED</span>');
          _WS.s.close();
        }
      };

      window.addEventListener('load', _WS.init, false);

    </script>
  </head>

  <body>
    <div class="container">
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
      <script src="../resource/js/bootstrap.min.js"></script>
      
      <div id="header">
        <h2 class="offset1">SublimeSocket Test Console</h2>
      </div>

      <div class="row offset1">
        <div class="input-append">
          <input class="span9" id="send" type="text" value="" />
          <button class="btn" type="button" onclick="_WS.send(document.getElementById('send').value);"/>input</button>
          <button type="submit" class="btn btn-danger" onclick="_WS.send('sublimesocket@killServer');"> 
          Stop
          </button>

        </div>
        
        <div>
          <select multiple="multiple" class="span9 offset2" style="height:280px" onchange="setter.set(this[this.selectedIndex].value)">
            <option>
ss@defineFilter:
{
    "name": "showLine",
    "patterns": [
        {
            "pa(tt)ern,([0-9].*)": [
                {
                    "runnable": {
                        "showLine": {
                            "line": "groups[1]",
                            "message": "message is groups[0]"
                        }
                    }
                }
            ]
        }
    ]
}
->filter: 
{
    "name": "showLine",
    "source": "pattern,10"
}
            </option>

            <option>
ss@detectView:
{
    "source": "/Users/sassembla/Library/Application Support/Sublime Text 2/Packages/SublimeSocket/SublimeSocketAPISettings.py(24,12): error CS1519: Unexpected symbol `void' in class, struct, or interface member declaration"
}
            </option>

            <option>
ss@defineFilter:
{
    "name": "s",
    "patterns": [
        {
            "-----CompilerOutput:-stdout--exitcode: (.+?)--.": [
                "runnable":{"eval":[\"sublime.message_dialog('groups[1]')\"]"
            ]
        }
    ]
}
->setTargetView:
{
    "path": "/Users/sassembla/Library/Application Support/Sublime Text 2/Packages/SublimeSocket/SublimeSocketAPISettings.py"
}
->filter:
{
    "name": "s",
    "source": "/Users/sassembla/Library/Application Support/Sublime Text 2/Packages/SublimeSocket/SublimeSocketAPISettings.py(24,12): error CS1519: Unexpected symbol `void' in class, struct, or interface member declaration"
}
            </option>

            <option>
ss@filter:
{
    "name": "s",
    "source": "/Users/sassembla/Library/Application Support/Sublime Text 2/Packages/SublimeSocket/SublimeSocketAPISettings.py(24,12): error CS1519: Unexpected symbol `void' in class, struct, or interface member declaration"
}
            </option>

            <option>
ss@setTargetView:
{
    "path": "/Users/sassembla/Library/Application Support/Sublime Text 2/Packages/SublimeSocket/SublimeSocketAPISettings.py"
}
            </option>

            <option>
ss@outputMessage:
{
    "message": "here comes Daredevil!"
}
            </option>

            <option>
ss@kvs:
{
    "showAll": "true"
}
            </option>

            <option>
ss@kvs:
{
    "showValue": "clientId"
}
            </option>

            <option>
ss@kvs:
{
    "removeValue": "clientId"
}
            </option>

            <option>
ss@kvs:
{
    "clear": "true"
}
            </option>
            

            <option>
ss@runSetting:
{
    "path": "/Users/sassembla/Desktop/UnityFilter.txt"
}
            </option>

            <option>
ss@defineFilter:
{
    "name": "s",
    "patterns": [
        {
            "-----CompilerOutput:-stdout--exitcode: (.+?)--.": {
                "runnable": "eval:[\"sublime.message_dialog('groups[1]')\"]"
            }
        }
    ]
}           
            </option>

            <option>
ss@defineFilter:
{
    "name": "s",
    "patterns": [
        {
            "-----CompilerOutput:-stdout--exitcode: (.+?)--.": {
                "runnable": {
                    "eval": [
                        "sublime.message_dialog('groups[1]')"
                    ]
                }
            }
        }
    ]
}
->filter:
{
    "name": "s",
    "source": "-----CompilerOutput:-stdout--exitcode: 1--compilationhadfailure: True--outfile: Temp/Assembly-CSharp.dll"
}
            </option>

            <option>
ss@defineFilter:
{
    "name": "s",
    "patterns": [
        {
            "-----CompilerOutput:-stdout--exitcode: (.+?)--.": {
                "runnable": {
                    "showStatusMessage": {}
                }
            }
        }
    ]
}
->filter:
{
    "name": "s",
    "source": "-----CompilerOutput:-stdout--exitcode: 1--compilationhadfailure: True--outfile: Temp/Assembly-CSharp.dll"
}
            </option>

            <option>
ss@setListenerEvent:
{
    "on_modified": {
        "outputMessage": {
            "message": "text's been modified!"
        }
    }
}
            </option>

            <option>
ss@eval:
[
    "sublime.message_dialog('show dialog from WebSocket Client')"
]
            </option>
            
            <option>
ss@eval:
[
    "self.getLineCount_And_SetToArray(active_view, 20, lines)",
    "regions.append(active_view.line(lines[0]))",
    "active_view.add_regions('hereComes', regions, 'comment', 'dot', sublime.DRAW_OUTLINED)"
]
            </option>

          </select>
        </div>
        
        
      </div>
      
    </div>
    
    <div id="output" class="offset2 span7"></div>


  </body>
</html>