<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="SublimeSocket : API server for SublimeText" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>SublimeSocket</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/sassembla/SublimeSocket">View on GitHub</a>

          <h1 id="project_title">SublimeSocket</h1>
          <h2 id="project_tagline">API server for SublimeText</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/sassembla/SublimeSocket/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/sassembla/SublimeSocket/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "<a href="http://www.w3.org/TR/html4/strict.dtd%22%3E">http://www.w3.org/TR/html4/strict.dtd"&gt;</a>

</p>
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 22.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; min-height: 18.0px}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;}
    p.p4 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;}
    p.p5 {margin: 0.0px 0.0px 0.0px 0.0px; font: 24.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; color: #ffffff; background-color: #001e57; min-height: 36.0px}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 24.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; color: #ffffff; background-color: #001e57}
    p.p7 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; background-color: #001e57; min-height: 27.0px}
    p.p8 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; background-color: #ebebeb}
    p.p9 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p10 {margin: 0.0px 0.0px 0.0px 0.0px; font: 24.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; color: #ffffff; background-color: #9e3517; min-height: 36.0px}
    p.p11 {margin: 0.0px 0.0px 0.0px 0.0px; font: 24.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; color: #ffffff; background-color: #9e3517}
    p.p12 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; background-color: #9e3517; min-height: 27.0px}
    p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; font: 20.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;}
    p.p14 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
    p.p15 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; background-color: #ebebeb}
    p.p16 {margin: 0.0px 0.0px 0.0px 0.0px; font: 24.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; color: #ffffff; background-color: #17546d; min-height: 36.0px}
    p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 24.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; color: #ffffff; background-color: #17546d}
    p.p18 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; background-color: #17546d; min-height: 27.0px}
    p.p19 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; color: #ffffff; background-color: #01546e}
    p.p20 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; color: #ffffff; background-color: #00546f}
    p.p21 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; color: #ffffff; background-color: #005470; min-height: 27.0px}
    p.p22 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; color: #ffffff; background-color: #005470}
    p.p23 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; color: #ffffff; background-color: #005471; min-height: 27.0px}
    p.p24 {margin: 0.0px 0.0px 0.0px 0.0px; font: 18.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;; color: #ffffff; background-color: #005471}
    span.s1 {font: 12.0px Helvetica}
    span.s2 {background-color: #ebebeb}
    span.s3 {font: 12.0px &amp;#39;Hiragino Kaku Gothic ProN&amp;#39;}
    span.s4 {font: 18.0px Helvetica}
    span.Apple-tab-span {white-space:pre}
  <p><b>SublimeSocket API Reference 0.8.7</b></p>

<p><b></b><br></p>

<p><b>Overview</b></p>

<p> SublimeTextのAPIを、WebSocket経由で実行するためのサーバです。</p>

<p> SublimeTextのプラグインとして実装されています。</p>

<p><br></p>

<p> WebSocket(RFC6455)によって、Local, Remoteの環境と組み合わせて動作します。</p>

<p><br></p>

<p> 文章中では、SublimeTextのことをST、SublimeSocketのことをSSと略機することがあります。</p>

<p><br></p>

<p><br></p>

<p><b>用途</b></p>

<p> ・SublimeSocketAPIを組み合わせてReactorをプログラミングし、ST上にログ情報を表示</p>

<p> ・ST上での特定のアクションに応じてコンパイル処理を走らせる</p>

<p> ・Remote環境のコンパイラとLocal環境のSTの連携</p>

<p> ・端末上のWebSocketクライアントとSTの連携</p>

<p><br></p>

<p><br></p>

<p><b>想定している連携例</b></p>

<p><b>  </b><img src="%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202013-04-05%2013.27.48.png" alt="スクリーンショット 2013-04-05 13.27.48.png"></p>

<p> サーバ側から、Log、StackTrace、SublimeSocketAPIなどの文字列データをSublimeSocketへと送付</p>

<p> ↓</p>

<p> SublimeSocketがデータ受信、API受付</p>

<p> ↓</p>

<p> SublimeTextに表示、編集アシスト動作</p>

<p><br></p>

<p> SublimeTextからキーイベント発行</p>

<p> ↓</p>

<p> SublimeSocket イベント着火</p>

<p> ↓</p>

<p> SublimeSocketからサーバ上のコンパイラにコンパイルオーダー</p>

<p> ↓</p>

<p> サーバ側でコンパイル</p>

<p> ↓</p>

<p> …</p>

<p><br></p>

<p> Yes! Yes! Yes! ずっとSublimeTextのターン！！</p>

<p> </p>

<p><br></p>

<p><b></b><br></p>

<p><b>API記法について</b></p>

<p><b></b><br></p>

<p><b></b><br></p>

<p><b>SSJSON (SublimeSocketJSON)</b></p>

<p> JSONに特定の文字列をつけて、APIの実行キーにしています。</p>

<p> 下記の文字で構成された文字列を受け取る事で、APIを実行します。</p>

<p><b></b><br></p>

<p><br></p>

<p>API_PREFIX = "sublimesocket"</p>

<p>API_PREFIX_SUB = "ss"</p>

<p> 特にSublimeServer向けの情報である事を示すPrefixです。</p>

<p> ぱっと見で明示するために付いています。</p>

<p> </p>

<p> フルに書くのがめんどくさい場合、ssで済ます事が出来ます。</p>

<p><br></p>

<p><br></p>

<p>API_DEFINE_DELIM = "@"   </p>

<p> ここから先がAPIのKeys and Values、という事を示すデリミタです。</p>

<p><br></p>

<p>             </p>

<p>API_CONCAT_DELIM = "-&gt;"</p>

<p> API同士を接続するデリミタです。</p>

<p> </p>

<p> 下記のように使用します。</p>

<p>ss@API-&gt;API-&gt;API</p>

<p> </p>

<p> -&gt; で連結したAPIは、記述順を守って実行されます。</p>

<p><br></p>

<p> </p>

<p>ss@Command1:JSON</p>

<p><br></p>

<p>ss@Command1:JSON-&gt;Command2:JSON-&gt;Command3:JSON,,,</p>

<p><br></p>

<p> JSON部分の内容は、各APIごとに必須パラメータ名、型が決められています。</p>

<p> また、パラメータ無しのAPIは、JSON部分無しで実行する事が出来ます。</p>

<p><br></p>

<p>ss@Command1</p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><b>Sample API</b></p>

<p> 下記は、STのログに "Hello World" を出すAPIのサンプルです。</p>

<p>ss@showAtLog:{"message":"Hello World"}</p>

<p><br></p>

<p> 色々なAPIを、SublimeSocket Test Console で試す事が出来ます。</p>

<p> CommandPalette -&gt; "SublimeSocket: on &gt; open preference" で、SublimeTextからSafariが起動します。</p>

<p><img src="%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202013-04-04%2022.14.03.png" alt="スクリーンショット 2013-04-04 22.14.03.png"></p>

<p> ss@showAtLog:{"message":"Hello World"}を入力したこの状態でInputを押すと、SublimeText内のコンソールに ss:Hello World と表示されているはずです。</p>

<p><br></p>

<p> <img src="c.png" alt="c.png"></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><b></b><br></p>

<p><b>API Reference</b></p>

<p><br></p>

<p><br></p>

<p><b> checkAPICompatibility</b></p>

<p>     Client側から想定しているSSのVersionを入力し、SSのVersionとの整合性チェックを行います。</p>

<p>     このAPIの主な用途は、Clientごとの使用VersionとSSのAPIVersionとの整合性チェックを適宜行うためのFailSafeです。</p>

<p> </p>

<p>     Versionの不整合が発生した場合でも、messageを返送するのみで、挙動には影響しません。</p>

<p><br></p>

<p> version[string]</p>

<p>     Client側が想定しているVersionの文字列です。"major.minor.changeLevel"</p>

<p>     </p>

<p> strict[bool]</p>

<p>     チェックの厳格さフラグです。</p>

<p>     trueの場合、minorバージョン未満の変更についても注意を発行します。</p>

<p> </p>

<p> e.g.</p>

<p>ss@checkAPICompatibility:</p>

<p>{</p>

<p>    "version": "0.0.1",</p>

<p>    "strict": true</p>

<p>}</p>

<p>return = CAUTION:    The current version = 1.0.0, please check API for using SSJSON filter.: </p>

<p><b></b><br></p>

<p><b></b><br></p>

<p><b> runSetting</b></p>

<p>     テキストファイルとして保存されているAPIを読み込み、実行します。</p>

<p><br></p>

<p> path[string]</p>

<p>     読み込むファイルのパスです。</p>

<p>     SUBLIMESOCKET_PATH:と付ける事で、SublimeSocketフォルダ内を参照するようにショートカットができます。</p>

<p><br></p>

<p> e.g. /Users/someone/Desktop//UnityFilter.txt ファイルを読み込み、APIとして実行</p>

<p>ss@runSetting:</p>

<p>{</p>

<p>    "path": "/Users/someone/Desktop/UnityFilter.txt"</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><b> inputIdentity</b></p>

<p>     SublimeSocket WebSocketのコネクションに名前をつける事が出来ます。</p>

<p><br></p>

<p> id[string]</p>

<p>     コネクションに付ける名前です。</p>

<p>     SSを中継して他Clientにメッセージを送る際などの宛名に使用します。</p>

<p><br></p>

<p> e.g. 送付元のClientのidをmyClientにする。</p>

<p>ss@inputIdentity:{"id":"myClient"}</p>

<p><br></p>

<p><br></p>

<p><b> tearDown</b></p>

<p>     SSのWebSocket service を終了します。</p>

<p><br></p>

<p> e.g. SSのサーバを落とす。</p>

<p>ss@ tearDown</p>

<p> (バグがあり、socket自体はそのまま生存、address already use が出てしまう　2013/04/05 10:35:52)</p>

<p><br></p>

<p><br></p>

<p><b> setReactor</b></p>

<p>     SublimeSocketに対して、特定のEventが発生した場合に動く、Reactorをセットします。</p>

<p>     eventとtargetの組み合わせによって、特定のEventに対して複数の動作をセットすることが可能です。</p>

<p><br></p>

<p> event[string]</p>

<p>     監視する対象のEvent名　"on_modified", "on_selection_modified", "on_pre_save", "on_post_save" など、</p>

<p>     SublimeTextが発行するものと、</p>

<p>     "ss_errorEmitted", "ss_f_noViewFound" など、SublimeSocketが発行するものがセットできます。</p>

<p><br></p>

<p> target[string]</p>

<p>     Reactorの識別に使用します。</p>

<p>     異なるtargetを設定する事で、同じEventに対して複数のReactorをセットする事が出来ます。</p>

<p><br></p>

<p> selectors[JSONArray[JSONObject[string:any]]]</p>

<p>     Event発生時に動作するAPIを記述できます。</p>

<p>     記述はJSONの配列形式で、APIのCommand部分を文字列キーにしたJSonObjectが使えます。</p>

<p><br></p>

<p> interval[int]</p>

<p>     実行間隔の数値です。</p>

<p>     0であればセット直後に一度だけ対象Eventの発生をチェックします。</p>

<p>     0以外の正の数であれば、ミリ秒ごとに対象Eventの発生をチェックします。</p>

<p><br></p>

<p> replacefromto[JSONObject[string:string]]</p>

<p>     Reactor発生時、Eventの持つパラメータを、selectorで指定したAPIに適応させる事が出来ます。</p>

<p>     {key:value}に対して、 Eventの持つkey名のパラメータの値を、selector内のvalue名のパラメータの値にします。</p>

<p><br></p>

<p> e.g. 選択範囲が更新されたら、STのログにHello Worldと表示する。</p>

<p>ss@setReactor:</p>

<p>{</p>

<p>    "target": "sublimesocketpreference",</p>

<p>    "event": "on_selection_modified",</p>

<p>    "selectors": [</p>

<p>        {</p>

<p>            "containsRegions": {</p>

<p>                "view": "will be replace to specific view",</p>

<p>                "target": "sublimesocketpreference",</p>

<p>                "emit": "ss_errorEmitted",</p>

<p>                "debug": true</p>

<p>            }</p>

<p>        }</p>

<p>    ],</p>

<p>    "replacefromto": {</p>

<p>        "view": "view"</p>

<p>    },</p>

<p>    "interval": 1000</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><b> setFoundationReactor</b></p>

<p>     ST上で発生する特殊なEventに対してReactorをセットします。</p>

<p>     Eventについては下記<b>EventReference</b>参照</p>

<p><br></p>

<p> event[string]</p>

<p>     対象Event名です。”ss_f_noViewFound”　などが該当します。</p>

<p>     あるビュー(ファイル)に対する操作が発生したとき、そのビューが現在開かれていない際に発行されます。</p>

<p><br></p>

<p>     条件があり、</p>

<p>     ・defineFilterが定義済み</p>

<p>     ・そのfilterにヒットするfilteriingが流入し</p>

<p>     ・対象ビューが探知できなかった</p>

<p>     場合に発生します。</p>

<p><br></p>

<p> selectors</p>

<p> replacefromto</p>

<p>     同 setReactor</p>

<p><br></p>

<p> e.g. Reactorセット後、フィルタ定義をし、そのフィルタにヒットするも該当するビューが開かれていない場合、STログにHello Worldを出力する。</p>

<p>ss@setFoundationReactor:</p>

<p>{</p>

<p>    "event": "ss_f_noViewFound",</p>

<p>    "selectors": [</p>

<p>        {</p>

<p>            "showAtLog": {</p>

<p>                "message": "Hello World"</p>

<p>            }</p>

<p>        }</p>

<p>    ]</p>

<p>}</p>

<p>-&gt;defineFilter:</p>

<p>{</p>

<p>    "name": "04/04/13 23:30:08",</p>

<p>    "patterns": [</p>

<p>        {</p>

<p>            "something": {</p>

<p>                "selectors": [</p>

<p>                    {</p>

<p>                        "showAtLog": {</p>

<p>                            "message": "Hello World"</p>

<p>                        }</p>

<p>                    }</p>

<p>                ]</p>

<p>            }</p>

<p>        }</p>

<p>    ]</p>

<p>}</p>

<p>-&gt;filtering:</p>

<p>{</p>

<p>    "name": "04/04/13 23:30:08",</p>

<p>    "source": "something"</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><b> kvs</b></p>

<p>     SS内のKey value storeを扱うAPIです。</p>

<p>     内部的にはPythonの辞書で実装されています。　この機能の実装は、そのまま別のKVSへとすげ替える事を念頭に隔離して実装されています。</p>

<p><br></p>

<p> showAll[string]</p>

<p>     全パラメータを文字列にSerializeしてClientへと返します。</p>

<p>     valueの意味はありません。</p>

<p><br></p>

<p> showValue[string]</p>

<p>     valueにしたパラメータをkeyに持つ値を返します。</p>

<p>     辞書や配列の場合、Serializeしたものを返します。</p>

<p><br></p>

<p> removeValue[string]</p>

<p>     valueにしたパラメータをkvsから削除します。</p>

<p><br></p>

<p> clear[string]</p>

<p>     kvsを空にします。</p>

<p>     valueの意味はありません。</p>

<p><br></p>

<p> e.g. kvsを空にする。</p>

<p>ss@kvs:</p>

<p>{</p>

<p>    "clear": "true"</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><b> defineFilter</b></p>

<p>     SSへとデータが流し込まれた際に反応するフィルタを定義します。</p>

<p>     定義されたフィルタはkvsへと保存され、特定のデータに対して反応します。</p>

<p><br></p>

<p> name[string]</p>

<p>     フィルタをidentifyするための文字列です。</p>

<p>     filtering APIと合わせて使用します。</p>

<p><br></p>

<p> patterns[JSONArray[JSONObject[string:any]]]</p>

<p>     正規表現をkeyにしたJSONObjectの配列です。</p>

<p>     keyにマッチするデータが流入した場合、value内のselectorsがAPIとして発生します。</p>

<p><br></p>

<p>     複数の正規表現を書いた場合、配列順に実行されます。</p>

<p>     複数のフィルタにマッチすることを許します。</p>

<p><br></p>

<p> e.g. 2013/04/04 23:30:08 という名前で、somethingで始まるデータが流入した場合、STログにHello World を出力する。</p>

<p>ss@defineFilter:</p>

<p>{</p>

<p>    "name": "04/04/13 23:30:08",</p>

<p>    "patterns": [</p>

<p>        {</p>

<p>            "^something": {</p>

<p>                "selectors": [</p>

<p>                    {</p>

<p>                        "showAtLog": {</p>

<p>                            "message": "Hello World"</p>

<p>                        }</p>

<p>                    }</p>

<p>                ]</p>

<p>            }</p>

<p>        }</p>

<p>    ]</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><b> filtering</b></p>

<p>     SSへとデータを流し込むAPIです。</p>

<p>     任意の文字列データをClientからSSへと流し込みます。</p>

<p><br></p>

<p> name[string]</p>

<p>     ターゲットとなるフィルタをidentifyする文字列です。</p>

<p>     事前にdefineFilterでセットされている必要があります。</p>

<p><br></p>

<p> source[string]</p>

<p>     文字列データです。</p>

<p>     APIの都合上、JSONで扱えない文字と、-&gt; (-と&gt;の連続) が入っている文字列を扱う事が出来ません。</p>

<p>     これらは事前にパースするとかでなんとかしてください。</p>

<p><br></p>

<p> debug[bool]</p>

<p>     デバッグ用パラメータです。</p>

<p>     セットされている場合はvalueに応じてデバッグ表示がSTのログに出力されます。</p>

<p><br></p>

<p> e.g. 2013/04/04 23:30:08 という名前が付けられたフィルタに対して、something という文字列を出力する。</p>

<p>ss@filtering:</p>

<p>{</p>

<p>    "name": "04/04/13 23:30:08",</p>

<p>    "source": "something"</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><b> containsRegions</b></p>

<p>     通常、setReactorに内包して使用します。</p>

<p>     特定のview(STで開かれているファイル)について、Reactorが指定したEventが発生したタイミングで、</p>

<p>     エディタの選択範囲にSTのRegionが存在する場合、emitキーワードで指定したEventを発行します。</p>

<p>     発行できるEventは、ss_errorEmitted" など SublimeSocket定義のEventに限られます。</p>

<p><br></p>

<p>     Eventについては下記<b>EventReference</b>参照</p>

<p><br></p>

<p> view[string]</p>

<p>     viewのファイルのパスです。</p>

<p><br></p>

<p> target[string]</p>

<p>     この文字列をtargetとして持つsetReactorへと、Eventを発行します。</p>

<p><br></p>

<p> emit[string]</p>

<p>     Event名の文字列です。</p>

<p>     ss_errorEmitted などが指定できます。</p>

<p><br></p>

<p> debug[bool]</p>

<p>     デバッグ用パラメータです。</p>

<p>     セットされている場合はvalueに応じてデバッグ表示がSTのログに出力されます。</p>

<p> </p>

<p> e.g.  ファイル /Users/USERNAME/Library/Application Support/Sublime Text 2/Packages/SublimeSocket/SublimeSocketAPISettings.py に対して、</p>

<p>     10行目にRegionが表示されます。</p>

<p>     <img src="%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202013-04-05%200.19.31.png" alt="スクリーンショット 2013-04-05 0.19.31.png"></p>

<p>     そのRegionをカーソルが選択範囲に含んだ際、</p>

<p>     sublimesocketpreference というtargetをもち、ss_errorEmitted Eventに反応するReactorに対して、Eventを発行します。</p>

<p>     viewパラメータは something Reactorのreplacefromtoによって、on_selection_modifiedが発生したviewへと置き換えられます。</p>

<p>     Event発行後、ss_errorEmitted に反応するReactorが発生し、Hello WorldがSTのログに出力され、 appendRegionの内容が実行されます。</p>

<p>     <img src="b.png" alt="b.png"></p>

<p>ss@setReactor:</p>

<p>{</p>

<p>    "target": "sublimesocketpreference",</p>

<p>    "event": "on_selection_modified",</p>

<p>    "selectors": [</p>

<p>        {</p>

<p>            "containsRegions": {</p>

<p>                "view": "will be replace to specific view",</p>

<p>                "target": "sublimesocketpreference",</p>

<p>                "emit": "ss_errorEmitted",</p>

<p>                "debug": true</p>

<p>            }</p>

<p>        }</p>

<p>    ],</p>

<p>    "replacefromto": {</p>

<p>        "view": "view"</p>

<p>    },</p>

<p>    "interval": 1000</p>

<p>}</p>

<p>-&gt;setReactor:</p>

<p>{</p>

<p>    "target": "sublimesocketpreference",</p>

<p>    "event": "ss_errorEmitted",</p>

<p>    "selectors": [</p>

<p>        {</p>

<p>            "showAtLog": {</p>

<p>                "message": "Hello World"</p>

<p>            }</p>

<p>        }</p>

<p>    ]</p>

<p>}</p>

<p>-&gt;appendRegion:</p>

<p>{</p>

<p>    "view": "/Users/USERNAME/Library/Application Support/Sublime Text 2/Packages/SublimeSocket/SublimeSocketAPISettings.py",</p>

<p>    "identity": "03/12/13 18:46:17",</p>

<p>    "line": 10,</p>

<p>    "message": "herecomes daredevil",</p>

<p>    "condition": "keyword"</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><b> collectViews</b></p>

<p>     STが開いているviewを収集し、kvsに保存します。</p>

<p><br></p>

<p>     特にパラメータはありません。</p>

<p>     SS起動時に自動的に呼ばれます。</p>

<p>     →SS起動時に自動的に実行されるAPIは、SSパッケージ内の SublimeSocket.sublime-settings に記述されています。</p>

<p>         "loadSettings" : ["collectViews"]</p>

<p><br></p>

<p> e.g. ST上で開いているviewを収集する。</p>

<p>ss@collectViews</p>

<p><br></p>

<p><br></p>

<p><b> runShell</b></p>

<p>     SSからPythonを経由してシェルスクリプトを実行します。</p>

<p>     bashなどの環境変数は引き継がれません。</p>

<p>     main, delay, debug　以外の文字列 "-a" や "something" などは、 そのままコマンドラインで実行されます。</p>

<p> </p>

<p>     ☆shell実行する都合上、value側に含まれるスペースを含む文字列 "a peaceful journey" などは、spaceが_に変換されます。</p>

<p>         他にも、"[" -&gt; "", "]" -&gt; "",  "<a href="https://github.com/s" class="user-mention">@s</a>@s@" -&gt; " " へと変換が発生します。</p>

<p> </p>

<p>         たとえばspaceを表示したい場合、SSへと入力する前の段階で、<a href="https://github.com/s" class="user-mention">@s</a>@s@ などに変換しておく必要があります。</p>

<p>         これは　"　をエスケープして文字列を囲んだ場合でもきちんと発生します。</p>

<p><br></p>

<p> main[string]</p>

<p>     コマンドラインの先頭に入る文字列です。</p>

<p><br></p>

<p> delay[int]</p>

<p>     指定ミリ秒後に実行します。</p>

<p><br></p>

<p> debug</p>

<p>     デバッグ用パラメータです。</p>

<p>     セットされている場合はvalueに応じてデバッグ表示がSTのログに出力されます。</p>

<p><br></p>

<p> 上記以外のkey[any]</p>

<p>     value部分には、string, int, bool のほか、 JSONArray[any] の指定が可能です。</p>

<p><br></p>

<p>     JSONObject形式で書いた場合、順がシャッフルされる可能性に注意してください。</p>

<p>     また、key、valueともに、空文字の指定が可能です。</p>

<p><br></p>

<p> e.g. ruby gems　"terminal-notifier"を実行します。文字列中のspaceは、_に強制的に変換されます。</p>

<p>         JSONObject版　key value の内容が、コマンドラインのパラメータとして実行されます。key-valueペアの順は守られますが、ペア同士がどの順で記述されるかは未定義です。</p>

<p>ss@runShell:</p>

<p>{</p>

<p>    "main": "terminal-notifier",</p>

<p>    "-message": "\"Hello, this is my message\"",</p>

<p>    "-title": "\"Message Title\"",</p>

<p>    "-execute": "\"open -a 'Sublime Text 2.App'\"",</p>

<p>    "debug": true</p>

<p>}</p>

<p><br></p>

<p>         JSONArray版　terminal-notifier -message "Hello,_this_is_my_message" -title "Message_Title" -execute "open_-a_'Sublime Text 2.App'" が実行されます。</p>

<p>ss@runShell:</p>

<p>{</p>

<p>    "main": "terminal-notifier",</p>

<p>    "-message": [</p>

<p>        "\"Hello, this is my message\"",</p>

<p>        "-title",</p>

<p>        "\"Message Title\"",</p>

<p>        "-execute",</p>

<p>        "\"open -a 'Sublime Text 2.App'\""</p>

<p>    ],</p>

<p>    "debug": true</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><b> broadcastMessage/monocastMessage</b></p>

<p>     SSを介して、他のClientへとWebSocket経由でメッセージを飛ばします。</p>

<p> </p>

<p> target</p>

<p>     monocastMessageの場合のみ有効な、送付先のIdentityです。</p>

<p>     inputIdentity を使う事で、Client側が自己申告できます。</p>

<p>     実行時点でSS上に存在しないidentityを指定した場合、エラーが発生します。</p>

<p><br></p>

<p> message[string]</p>

<p>     Clientへと送付される文字列です。</p>

<p><br></p>

<p> sender[stirng]</p>

<p>     オプションです。</p>

<p>     送付元の情報をidentifyする事が出来ます。</p>

<p>     このキーがあることで、Clientへと到達する情報は、</p>

<p>     senderのvalue:messageのvalue になります。</p>

<p><br></p>

<p> e.g.</p>

<p>ss@monocastMessage:</p>

<p>{</p>

<p>    "message": "here comes Daredevil! for only one",</p>

<p>    "target": "sublimesocketpreference"</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><b> showAtLog</b></p>

<p>     文字列をSTのログに出力します。</p>

<p>     主にユーザーへの通知や、動作確認に使用します。</p>

<p><br></p>

<p> message[string]</p>

<p>     ログに出力される文字列です。</p>

<p><br></p>

<p> e.g.</p>

<p>ss@showAtLog:{"message":"Hello World"}</p>

<p><br></p>

<p> </p>

<p><b> appendRegion</b></p>

<p>     STで現在開かれている特定のviewへと、Region(四角形)を表示します。</p>

<p>     情報はkvsのSUBDICT_REGIONS下に保存されます。　eraseAllRegions が発生したタイミングで、削除されます。</p>

<p><br></p>

<p>        メッセージ情報他を埋め込むことができます。</p>

<p><br></p>

<p> view[string]</p>

<p>        ファイル名を含むpathです。</p>

<p>        フルパスが存在する場合、そのままviewを特定する要素として使用されます。</p>

<p>     フルパスでない場合、適当に推測します。</p>

<p><br></p>

<p>        最低でもファイル名.拡張子を含んでいる必要があります。</p>

<p>        </p>

<p>        該当するviewがSTのview上に発見できなかった場合、”ss_f_noViewFound” Eventを発行します。</p>

<p><br></p>

<p> line[int]</p>

<p>        Regionを表示する行番号です。</p>

<p><br></p>

<p> message</p>

<p>        Regionに保存する文字列データです。</p>

<p><br></p>

<p> condition</p>

<p>        Regionのカラーリングを決定するパラメータです。</p>

<p>     STのColor Schemeと連動しています。</p>

<p>        SSでは、適当ですが、 keyword パラメータをError用、string パラメータをCaution用に使用しています。</p>

<p><br></p>

<p>    e.g. ファイル /Users/USERNAME/Library/Application Support/Sublime Text 2/Packages/SublimeSocket/SublimeSocketAPISettings.py に対して、</p>

<p>     10行目にRegionが表示されます。</p>

<p>     <img src="1__%23%24!@%25!%23__%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202013-04-05%200.19.31.png" alt="1__#$!@%!#__スクリーンショット 2013-04-05 0.19.31.png"></p>

<p>ss@appendRegion:</p>

<p>{</p>

<p>    "view": "/Users/USERNAME/Library/Application Support/Sublime Text 2/Packages/SublimeSocket/SublimeSocketAPISettings.py",</p>

<p>    "identity": "03/12/13 18:46:17",</p>

<p>    "line": 10,</p>

<p>    "message": "herecomes daredevil",</p>

<p>    "condition": "keyword"</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><b> notify</b></p>

<p>     MacのNotificationCenterを起動し、任意の文字列を表示します。</p>

<p> <img src="%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202013-04-05%201.08.12.png" alt="スクリーンショット 2013-04-05 1.08.12.png"></p>

<p> title[string]</p>

<p>     タイトル用の文字列です。</p>

<p><br></p>

<p> message[string]</p>

<p>     メッセージ用の文字列です。</p>

<p>     "_"を" "(space)に勝手に変換します。</p>

<p><br></p>

<p> debug</p>

<p>     デバッグ用パラメータです。</p>

<p>     セットされている場合はvalueに応じてデバッグ表示がSTのログに出力されます。</p>

<p> </p>

<p> e.g.</p>

<p>ss@notify:</p>

<p>{</p>

<p>    "title": "title-is-here",</p>

<p>    "message": "message-of-nyaaa"</p>

<p>}</p>

<p><br></p>

<p> 補記：   Linux、Windowsのことは考えずに作りましたが、下記サンプルでgrowlでの通知が可能です。</p>

<p>ss@runShell:</p>

<p>{</p>

<p>    "main": "/usr/local/bin/growlnotify",</p>

<p>    "-m": "message!",</p>

<p>    "-t": "Saved!",</p>

<p>    "-a": "\"Sublime Text 2\"",</p>

<p>    "debug": true</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><b></b><br></p>

<p><b>Event Reference</b></p>

<p><br></p>

<p> 各Eventについて、setReactor APIでReactorをセットする事が出来ます。</p>

<p> setReactorでcaptureできる各Eventが保持するパラメータについては、各Eventの項を確認してください。</p>

<p><br></p>

<p><b>SublimeText-Event</b></p>

<p> SublimeTextから発生するEventは下記になります。 発生タイミングなどの詳細は、同名のSublimeTextのAPI Referenceを参考にしてください。</p>

<p><br></p>

<p>    <b>on_selection_modified,  </b></p>

<p><b> on_pre_save, </b></p>

<p><b> on_post_save, </b></p>

<p><b> on_modified</b></p>

<p>     </p>

<p>     これらのEventは、Reactorのinterval指定に従って発生判定を行っています。</p>

<p>     一定時間内に複数回発生したとしても、最後に発生したEventのみが、intervalに合わせて処理されます。</p>

<p><br></p>

<p>         REACTIVE_INTERVAL_EVENT = ["on_modified", "on_selection_modified", "on_pre_save", "on_post_save"]</p>

<p>         </p>

<p><br></p>

<p><b>  Event params</b></p>

<p>     すべてのEventが下記paramを発行します。</p>

<p>     setReactorでは下記paramをreplacefromtoで転用可能。</p>

<p><br></p>

<p>    view[sublimetext_view_instance]</p>

<p>     SublimeText view</p>

<p><br></p>

<p> viewId[int]</p>

<p>     SublimeText  view.view.id()</p>

<p><br></p>

<p> bufferId[int]</p>

<p>     SublimeText view.buffer_id()</p>

<p><br></p>

<p> path[string]</p>

<p>     SublimeText view.file_name()</p>

<p><br></p>

<p> basename[string]</p>

<p>     os.path.basename(view.file_name())</p>

<p><br></p>

<p> vname[string]</p>

<p>     SublimeText view.name()</p>

<p><br></p>

<p><br></p>

<p><b>Sub</b><b>limeSocket-Event</b></p>

<p> SublimeSocketから発生するEventは下記になります。</p>

<p>     </p>

<p><b>  foundation series</b></p>

<p>     emitなどで発行することは不可能です。</p>

<p><br></p>

<p><b> ss_f_noViewFound</b></p>

<p>     appendRegion API使用時、該当のviewがSTのview内に存在しない場合に発行されます。</p>

<p>     発生したタイミングで、Reactorが反応します。</p>

<p><br></p>

<p><br></p>

<p> message[string]</p>

<p> view[string]</p>

<p> line[string]</p>

<p> condition[string]</p>

<p>     パラメータはすべて、appendRegion APIへと入力された値が使用されます。</p>

<p> </p>

<p> e.g. パラメータ例</p>

<p>{</p>

<p>    "view": "/Users/USERNAME/Library/Application Support/Sublime Text 2/Packages/SublimeSocket/SublimeSocketAPISettings.py",</p>

<p>    "identity": "03/12/13 18:46:17",</p>

<p>    "line": 10,</p>

<p>    "message": "herecomes daredevil",</p>

<p>    "condition": "keyword"</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><b>  user-emittable series</b></p>

<p>     emitがあるAPI経由で発行することが可能です。</p>

<p>     すべてのEventは、emit元が持つパラメータを持ちます。</p>

<p><br></p>

<p>     各Eventの差は、identityのみです。</p>

<p><br></p>

<p>    <b>ss_eventEmitted</b></p>

<p><b>      </b>containsRegions API のemitに指定できるEventです。</p>

<p>     setReactorで反応する要素をセットしておく事で、対応するEventに対してのみ反応することができます。</p>

<p><br></p>

<p>    <b>ss_errorEmitted</b></p>

<p>     containsRegions API のemitに指定できるEventです。</p>

<p>     setReactorで反応する要素をセットしておく事で、対応するEventに対してのみ反応することができます。</p>

<p>                 </p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><b></b><br></p>

<p><b>saveなどのユーザー動作と組み合わせたEventの例</b></p>

<p> ・setReactorでユーザーの on_post_save を監視</p>

<p>     →発生時に動作するEventをselectorに定義</p>

<p><br></p>

<p> e.g. setReactorを使い、on_post_save Event発生時に、Hello World とSTのログへと出力します。</p>

<p>ss@setReactor:</p>

<p>{</p>

<p>    "target": "sublimesocketpreference",</p>

<p>    "event": "on_post_save",</p>

<p>    "selectors": [</p>

<p>        {</p>

<p>            "showAtLog": {</p>

<p>                "message": "Hello World"</p>

<p>            }</p>

<p>        }</p>

<p>    ],</p>

<p>    "interval": 1000</p>

<p>}</p>

<p><br></p>

<p><b></b><br></p>

<p><b></b><br></p>

<p><b>ユーザーによる範囲選択動作とRegionの選択を組み合わせたEventの例</b></p>

<p> ・setReactorでユーザーの on_selection_modified Event を監視</p>

<p>     →selector中で、containsRegions API をセット、</p>

<p>         該当するview範囲に既設のRegionが含まれているかどうかチェックし、</p>

<p>         適当なEventをemit</p>

<p><br></p>

<p> ・setReactorで上記セットしたEventを監視</p>

<p>     →selector中で任意の動作を行う</p>

<p><br></p>

<p> e.g.    appendRegionで実際にRegionを発生させるサンプル。</p>

<p>     on_selection_modifiedに反応するReactor内で、既設のRegionへの反応を記述。範囲がRegionを含んでいた場合、ss_errorEmitted Eventを発行。</p>

<p>     ss_errorEmitted Eventが発行された場合、対応するReactorにて、showAtLogが発生する。</p>

<p>ss@setReactor:</p>

<p>{</p>

<p>    "target": "sublimesocketpreference",</p>

<p>    "event": "on_selection_modified",</p>

<p>    "selectors": [</p>

<p>        {</p>

<p>            "containsRegions": {</p>

<p>                "view": "will be replace to specific view",</p>

<p>                "target": "sublimesocketpreference",</p>

<p>                "emit": "ss_errorEmitted",</p>

<p>                "debug": true</p>

<p>            }</p>

<p>        }</p>

<p>    ],</p>

<p>    "replacefromto": {</p>

<p>        "view": "view"</p>

<p>    },</p>

<p>    "interval": 1000</p>

<p>}</p>

<p>-&gt;setReactor:</p>

<p>{</p>

<p>    "target": "sublimesocketpreference",</p>

<p>    "event": "ss_errorEmitted",</p>

<p>    "selectors": [</p>

<p>        {</p>

<p>            "showAtLog": {</p>

<p>                "message": "Hello World"</p>

<p>            }</p>

<p>        }</p>

<p>    ]</p>

<p>}</p>

<p>-&gt;appendRegion:</p>

<p>{</p>

<p>    "view": "/Users/sassembla/Library/Application Support/Sublime Text 2/Packages/SublimeSocket/SublimeSocketAPISettings.py",</p>

<p>    "identity": "03/12/13 18:46:17",</p>

<p>    "line": 10,</p>

<p>    "message": "herecomes daredevil",</p>

<p>    "condition": "keyword"</p>

<p>}</p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><b>サンプルフィルタ</b></p>

<p> いくつか、サンプルのフィルタがあります。</p>

<p><br></p>

<p> TypeScript用のフィルタ</p>

<p>     SublimeSocket/FilterSettingSamples/TypeScriptFilter.txt</p>

<p><b>  </b></p>

<p> tscが出力するログに対して、エラー行を表示しています。</p>

<p> すべてフィルタやReactorで書かれています。</p>

<p><br></p>

<p> API runSettingで読み込むとそのまま使える状態ですので、がんばってみてください。</p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><br></p>

<p><b>Tool</b></p>

<p> 色々ある。書き足す。</p>

<p><br></p>

<p><br></p>

<p>
</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">SublimeSocket maintained by <a href="https://github.com/sassembla">sassembla</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
